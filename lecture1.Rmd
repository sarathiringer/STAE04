---
title: "STAE04: Data Visualization"
subtitle: "Lecture 1"
author: "Johan Larsson"
institute: "Department of Statistics, Lund University"
date: "`r Sys.Date()`"
titlegraphic: "lu.pdf"
bibliography: STAE04.bib
fontsize: "10pt"
citation-package: bibtex
output: 
  rmdplugr::pdf_presentation:
    colortheme: dove
    citation_package: "biblatex"
setbeamertemplate:
  - item: itemize items
    value: circle
fonttheme:
  - professionalfonts
  - structurebold
header-includes:
  - \usepackage{booktabs}
  - \usepackage{longtable}
  - \usepackage{array}
  - \usepackage{multirow}
  - \usepackage{wrapfig}
  - \usepackage{float}
  - \usepackage{colortbl}
  - \usepackage{pdflscape}
  - \usepackage{tabu}
  - \usepackage{threeparttable}
  - \usepackage{threeparttablex}
  - \usepackage[normalem]{ulem}
  - \usepackage[normalem]{ulem}
  - \usepackage[utf8]{inputenc}
  - \usepackage{makecell}
  - \usepackage{xcolor}
  - \usepackage{mathtools}
  - \usepackage{booktabs}
  - \DeclareMathOperator{\E}{\text{E}}
  - \DeclareMathOperator{\Var}{Var}
  - \DeclareMathOperator{\Cov}{Cov}
  - \usepackage{multirow}
  - \usepackage{subfig}
  - \usepackage{systeme}
  - | 
    `\setbeamertemplate{frametitle}[default][center]`{=latex}
    `\setbeamertemplate{itemize items}[circle]`{=latex}
    `\setbeamerfont{frametitle}{size=\large}`{=latex}
    `\setbeamertemplate{headline}{\vskip5ex}`{=latex}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE,
  cache = FALSE,
  fig.width = 5,
  fig.height = 3.5,
  dev.args = list(pointsize = 8)
)

library(tidyverse)
library(tactile)
library(lattice)
library(latticeExtra)
library(kableExtra)

theme_johan <- function(base_size = 12, base_family = "") {
  theme_bw(base_size = base_size, base_family = base_family) %+replace% 
    theme(panel.border = element_rect(fill = NA, colour = "black"), 
          axis.ticks = element_line(colour = 1))
}

kable <- function(x, ...) {
  knitr::kable(x, escape = FALSE, linesep = "", booktabs = TRUE)
}

if (!interactive()) {
  trellis.par.set(tactile.theme(c(10, 5)))
  theme_set(theme_bw(base_size = 7))
  
} else {
  trellis.par.set(tactile.theme(c(12, 8)))
  theme_set(theme_bw(base_size = 11))
  options(knitr.table.format = "latex")
}

options(digits = 3)
```

# Why visualize?

-------------------------

```{r, fig.cap = "Annual size of global datasphere [@reinsel2018]."}
d <- tibble(x = c(2010:2018, 2018:2025),
            y = c(2, 5, 6.5, 9, 12.5, 15.5, 18, 26, 33,
                  33, 41, 50.5, 64.5, 79.5, 101, 129.5, 175),
            type = as.factor(rep(c("true", "projected"), c(9, 8)))) %>%
  mutate(type = relevel(type, "true"))

ggplot(d, aes(x = x, y = y, lty = type)) +
  geom_line() +
  geom_point() +
  ylab("size (zettabytes)") +
  xlab("year") +
  theme(legend.title = element_blank())
```

-------------------------

```{r, fig.cap = "Interest in data visualization as a fraction of the maximum interest recorderd (using Google Trends). The blue line represents a moving average."}
d <- read_csv("data/dataviz-trends.csv") %>%
  mutate(date = as.Date(paste0(date, "-01")))
ggplot(d, aes(x = date, y = interest)) +
  geom_line(col = "grey50") +
  geom_smooth(se = FALSE) +
  ylim(0, 100) +
  xlab("year") +
  ylab("interest in data visualization")
```

## Visualization as communication

* main goal is to **communicate** patterns in data
* we are wired to learn from **seeing**

```{r}

```


## Tables vs. visualizations

::: {.columns}
:::: {.column width=0.5}
```{r}
swe_employment <- readRDS("data/swe_employment.rds")

tmp <- select(swe_employment, region, employment)
tmp[!duplicated(tmp), ] %>%
  as_tibble() %>%
  kable() %>%
  kable_styling(font_size = 7)
```
::::

. . .

:::: {.column width=0.5}
```{r}
ggplot(swe_employment, aes(long, lat, group = region, fill = employment)) +
  geom_polygon() +
  coord_equal() +
  theme_void()
```

::::
:::

# An example

## f

```{r}
gdURL <- "http://www.stat.ubc.ca/~jenny/notOcto/STAT545A/examples/gapminder/data/gapminderWithColorsAndSorted.txt"
kDat <- read.delim(file = gdURL, as.is = 7) # protect color
## alternative command is you save data file locally
#gDat <- read.delim("gapminderWithColorsAndSorted.txt")
str(kDat <- droplevels(subset(kDat, continent != "Oceania")))
```


# An example

## Survival on the Titanic

```{r}
kable(head(as_tibble(Titanic))) %>%
  kable_styling(position = "center")
```

```{r, out.width = "3in", fig.cap = "The Titanic"}
knitr::include_graphics("images/titanic.png")
```

## First idea: barchart

```{r}
titanic <- as_tibble(Titanic)
ggplot(titanic, aes(Class, n, fill = Survived)) +
  geom_col() +
  facet_grid(vars(Sex), vars(Age))
```

## Next: transform variable

```{r}
as_tibble(Titanic) %>%
  pivot_wider(names_from = Survived, values_from = n) %>%
  mutate(SurvivalRate = ifelse(Yes + No > 0, Yes/(Yes + No), NA)) %>%
  ggplot(aes(Class, SurvivalRate, group = Sex, fill = Sex)) +
  geom_col(position = "dodge") +
  facet_grid(vars(Age))
```


## Third idea: use a mosaic plot

```{r, fig.width = 7, fig.height = 5}
library(vcd)
args <- list(
  labeling_args = list(gp_labels = gpar(fontsize = 7), 
                            gp_varnames = gpar(fontsize = 9, font = 2),
                            abbreviate_labs = c(Sex = TRUE)),
  gp = gpar(fill = c("grey80", "darkolivegreen1"))
)
cotabplot(~ Survived + Age + Sex | Class,  
          text_gp = gpar(fontsize = 10),
          Titanic, 
          panel_args = args)
```

# Learning outcomes

## Knowledge and understanding

* demonstrate knowledge of the theoretical and practical construction of 
  visualisations, and
* demonstrate understanding of how the type of data impacts the visualisation
  and what components are appropriate.
    
## Competence and skills

* demonstrate the skill to independently, using software, visualise various 
  types of data,
* demonstrate the ability to make appropriate choices in designing 
  visualisations, and
* demonstrate the ability to in writing present and discuss visualisations
  in dialogue with others.
    
## Judgment and approach

* demonstrate the ability to assess visualisations with respect to 
  clarity, accessibility and ethics, and
* demonstrate insight into the importance of the design of visualisations
  with respect to communicative properties, accessibility and ethics.

# Course structure

## Topics

## R and ggplot2

## Course book

# References
