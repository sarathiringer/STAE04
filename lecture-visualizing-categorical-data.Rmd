---
title: "Visualizing Categorical Data"
subtitle: "STAE04: Data Visualization"
author: "Johan Larsson"
institute: "The Department of Statistics, Lund University"
date: ""
bibliography: "assets/stae04.bib"
output:
  xaringan::moon_reader:
    css: [default, "assets/stae04.css"]
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      titleSlideClass: [middle, center]
      countIncrementalSlides: false
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  warning = FALSE,
  message = FALSE,
  cache = FALSE,
  dev = "svg",
  fig.width = 3.5,
  fig.height = 3,
  fig.align = "center"
)

knitr::knit_hooks$set(crop = knitr::hook_mogrify)

library(tidyverse)
library(tactile)
library(lattice)
library(latticeExtra)
library(kableExtra)

kable <- function(x, ...) {
  knitr::kable(x, escape = FALSE, linesep = "", booktabs = TRUE)
}



library(RefManageR)
BibOptions(check.entries = FALSE, 
           bib.style = "authoryear",
           style = "markdown",
           dashed = TRUE)
bib <- ReadBib("assets/stae04.bib")

theme_set(theme_bw())

if (!interactive()) {
  theme_set(theme_grey(base_size = 14))
}

options(digits = 3)
```

## Visualizing Categorical Data

visualizing categorical data is really about visualizing proportions

ggplot2 has **limited** capabilities for visualizing categorical data

---

## Bar Charts

**bar** charts are intuitive and obiquitous

plots up to three categories at once with the use of **facets**

```{r, fig.width = 5, fig.height = 2.8, fig.cap = "Happiness ratings from the GSS in the US."}
library(productplots) # for happy data set
happy <- drop_na(happy)

ggplot(happy, aes(happy)) + geom_bar()
```

---

## Grouped Bar Chart

makes it easy to compare between categories, but harder to judge composition within categories

```{r, fig.cap = "A grouped barchart.", fig.width = 8}
ggplot(happy, aes(degree, fill = happy)) +
  geom_bar(position = "dodge")
```

---

## Stacked Barchart

makes it easy to compare within categories, but difficult to judge between categories

```{r, fig.cap = "A stacked barchart.", fig.width = 8}
ggplot(happy, aes(degree, fill = happy)) +
  geom_bar() # position = "stack" is the default
```

---

## Proportional Stacked Barchart

easy to compare both between and within categories but lose information on category size

```{r, fig.cap = "A stacked bar chart. Y axis unit is now proportions.", fig.width = 8}
ggplot(happy, aes(degree, fill = happy)) +
  geom_bar(position = "fill") +
  ylab("Proportion")
```

---

## Mosaic Plots

a type of stacked barchart that maps category size to 
the width of bars

need to use another package for this: [productplots](https://CRAN.R-project.org/package=productplots) or [ggmosaic](https://CRAN.R-project.org/package=ggmosaic)

```{r, fig.width = 8}
library(productplots)
prodplot(drop_na(happy), ~ happy + degree) +
  aes(fill = happy) +
  theme(legend.position = "none") # remove legend
```

---

## Waffle Plots

suitable when there are large differences between categories

again need to use a new package: [waffle](https://CRAN.R-project.org/package=waffle)


```{r, echo = FALSE, fig.width = 8, fig.height = 3, fig.cap = "A waffle plot of the happiness data. Every square represents 100 people. The code is quite complicated (see the source code for this slide)."}
# devtools::install_github("hrbrmstr/waffle")
library(waffle)

happier <- 
  group_by(happy, degree) %>%
  count(happy) %>%
  mutate(n = round(n/100))

ggplot(happier, 
       aes(fill = happy, 
           values = n)) +
  geom_waffle(color = "white", 
              size = 1.125, 
              n_rows = 10,
              flip = TRUE) +
  facet_wrap(~degree, nrow = 1) +
  coord_equal() +
  theme_minimal(base_size = 14) +
  theme_enhance_waffle()
```


---

## Euler and Venn Diagrams


useful when relationships between categorical variables is at interest

not always possible to get **exact** diagram for more than two categories

.pull-left[
```{r eulerr, eval = FALSE}
library(eulerr)

combo <- c(
  "happy" = 100, 
  "graduated" = 40,
  "happy&graduated" = 35
)

# fit and inspect
r <- euler(combo)

# plot
plot(r)
```
]

.pull-right[
```{r ref.label = "eulerr", echo = FALSE}

```
]


.footnote[
Disclaimer: Johan Larsson is the author of [eulerr](https://CRAN.R-project.org/package=eulerr).
]

---

## More on Visualizing Categorical Data

much more to learn on visualizations of categorical data

packages [vcd](https://CRAN.R-project.org/package=vcd) and 
[vcdExtra](https://CRAN.R-project.org/package=vcdExtra) offer lots of functionality


```{r, echo = FALSE, fig.width = 7, fig.height =6, fig.cap = "A plot from the vcd package."}
library(vcd)
UCB <- aperm(UCBAdmissions[, , 1:3], c(2, 1, 3))
names(dimnames(UCB)) <- c("Sex", "Admit?", "Department")
dimnames(UCB)[[2]] <- c("Yes", "No")
fourfold(UCB, mfrow = c(1, 3))
```



